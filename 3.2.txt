3.2 Offer Submission & Acceptance Flow
Structured Flow (hyphen based)
Buyer
- Sends POST /offers
- Payload: productId, amount
Offer Module
- OfferService.create() is executed
- Validate product is active
- Reject if buyer is the product owner
- Reject if another pending offer exists for the same product
- Validate offer amount is reasonable (minimum 50 percent of product price)
- Prevent race conditions using row-level locking (FOR UPDATE SKIP LOCKED)
- Insert offer record into database
- Emit event: offer.created
Notification Worker
- Send push notification to seller: New offer received
- Send email to seller: A new offer has been submitted for your product
Seller
- Reviews the incoming offer
Seller Decision
- Accept offer via POST /offers/{id}/accept
- Reject offer via POST /offers/{id}/reject
Offer Acceptance Logic
- Begin database transaction
- Lock offer record with version check
- Lock related product record
- Reject all other pending offers for the product
- Mark the selected offer as accepted
- Reserve the product
- Create an order with pending_payment status
- Commit transaction
- Emit event: offer.accepted
Order Created
- Order status: pending_payment
- Push notification sent to buyer: Offer accepted, payment required
Plain Text Explanation
The offer submission process starts when a buyer submits an offer for a product by sending a request to
the backend API. The Offer module validates that the product is active, ensures the buyer is not the
product owner, checks that there are no other pending offers for the same product, and verifies that the
offered price meets the minimum acceptable threshold. To avoid race conditions, the product row is locked
before the offer is persisted. After successful validation, the offer is stored in the database and an
offer.created event is emitted. Once the offer is created, notification workers inform the seller via push
notification and email. The seller reviews the offer and decides whether to accept or reject it. If the offer is
rejected, the process ends for that offer. If the seller accepts the offer, the system starts a transactional
acceptance flow. Both the offer and product records are locked, all other pending offers for the same
product are rejected, and the selected offer is marked as accepted. The product is reserved and a new
order with a pending payment status is created. After committing the transaction, an offer.accepted event
is emitted and the buyer is notified that payment is required to complete the purchase.