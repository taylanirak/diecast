4.1 Entity Relationship Overview (PostgreSQL)
users
- id (PK)
- email
- phone
- password
- is_verified
- is_seller
- created_at
products
- id (PK)
- seller_id (FK → users.id)
- category_id
- title
- description
- price
- condition
- status
- created_at
- version
offers
- id (PK)
- product_id (FK → products.id)
- buyer_id (FK → users.id)
- seller_id (FK → users.id)
- amount
- status
- expires_at
- version
orders
- id (PK)
- order_number
- buyer_id (FK → users.id)
- seller_id (FK → users.id)
- product_id (FK → products.id)
- offer_id (FK → offers.id)
- total_amount
- commission
- status
- created_at
- version
addresses
- id (PK)
- user_id (FK → users.id)
- city
- district
- address
product_images
- id (PK)
- product_id (FK → products.id)
- url
- sort_order
payments
- id (PK)
- order_id (FK → orders.id)
- provider
- amount
- status
- external_reference
- created_at
payment_holds
- id (PK)
- payment_id (FK → payments.id)
- seller_id (FK → users.id)
- amount
- status
- held_until
shipments
- id (PK)
- order_id (FK → orders.id)
- carrier
- tracking_number
- status
- created_at
shipment_events
- id (PK)
- shipment_id (FK → shipments.id)
- status
- description
- event_time
admin_users
- id (PK)
- user_id (FK → users.id)
- role
- permissions
- is_active
- created_by
commission_rules
- id (PK)
- rule_type
- category_id
- seller_type
- rate
- priority
- is_active
audit_logs
- id (PK)
- admin_id (FK → admin_users.id)
- action
- entity_type
- entity_id
- changes
- ip_address
- created_at
platform_settings
- id (PK)
- key
- value
- type
- updated_by
analytics_snapshots
- id (PK)
- type
- date
- data (JSONB)
- created_at
Plain Text Explanation
The database schema is designed around a transactional marketplace model where users can list
products, submit offers, complete purchases, and manage shipping and payments. The users table acts
as the central identity store for buyers, sellers, and administrators. Products are owned by sellers and can
receive multiple offers from buyers, which are tracked in the offers table with versioning to support
concurrency control. Once an offer is accepted or a direct purchase is completed, an order record is
created to represent the transaction. Payments and payment holds are separated to support
escrow-based payment flows, while shipments and shipment events provide full shipment lifecycle
tracking. Administrative operations such as commission calculation, auditing, and configuration
management are supported through dedicated tables like commission_rules, audit_logs, and
platform_settings. Analytics snapshots store historical and aggregated data to support reporting and
business intelligence use cases.