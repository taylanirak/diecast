3.3 Admin Commission Calculation
Structured Flow (hyphen based)
OrderService.calculateCommission(order)
Fetch Active Commission Rules
- Query commission_rules table
- Filter by is_active = true
- Order by priority descending
Find Matching Rule
- Check exact match: category_id + seller_type
- If matched, use this rule
- Else check category match: category_id only
- If matched, use this rule
- Else check seller type match: seller_type only
- If matched, use this rule
- Else use default rule where rule_type = default
Calculate Commission
- commission = order.total_amount x rule.rate
- Apply minimum limit if commission is below minimum
- Apply maximum limit if commission exceeds maximum
Store Commission
- Update orders table with commission_amount
- Insert commission snapshot into analytics_snapshots table
Example
Order amount: 250 TL
Product category: Action Figures
Seller type: Verified
Commission rules
- Priority 10: Category Action Figures + Seller Verified → 4 percent
- Priority 5: Category Action Figures → 6 percent
- Priority 0: Default rule → 5 percent
Result
- Applied commission rate: 4 percent
- Commission amount: 250 x 0.04 = 10 TL
Plain Text Explanation
The admin commission calculation process is executed as part of the order lifecycle through the
OrderService. When commission calculation is triggered, the system first retrieves all active commission
rules from the database, ordered by priority to ensure the most specific rules are evaluated first. The
matching process follows a strict hierarchy. The system first attempts to find an exact rule match based on
both product category and seller type. If no exact match is found, it falls back to category-based rules, then
seller-type-based rules, and finally a default rule. This guarantees predictable and deterministic
commission selection. Once a rule is selected, the commission amount is calculated by multiplying the
order total with the rule’s rate. Minimum and maximum limits are applied to ensure commissions stay
within defined boundaries. The final commission amount is then stored directly on the order record and
also recorded in analytics snapshots for reporting and auditing purposes.